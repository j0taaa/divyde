// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Friends where this user is the owner
  friends Friend[]
  // Debts created by this user
  debts   Debt[]

  // Session tokens
  sessions Session[]
}

model Session {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([token])
  @@index([userId])
}

model Friend {
  id        String   @id @default(cuid())
  name      String
  email     String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Avatar settings (stored as JSON string or individual fields)
  avatarType      String  @default("initials") // "initials" or "custom"
  avatarColor     String? // For initials avatar
  avatarHairColor String? // For custom avatar
  avatarHairStyle String? // For custom avatar
  avatarEyeColor  String? // For custom avatar
  avatarSkinColor String? // For custom avatar
  avatarBgColor   String? // For custom avatar

  // Debts with this friend
  debts Debt[]

  @@index([userId])
}

model Debt {
  id          String   @id @default(cuid())
  amount      Float
  direction   String   // "they-owe" or "you-owe"
  description String?
  isPaid      Boolean  @default(false)
  date        DateTime @default(now())
  paidAt      DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  userId   String
  user     User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  friendId String
  friend   Friend @relation(fields: [friendId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([friendId])
  @@index([isPaid])
}
